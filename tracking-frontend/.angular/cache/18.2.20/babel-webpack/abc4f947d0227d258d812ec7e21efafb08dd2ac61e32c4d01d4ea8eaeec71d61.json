{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { StatusBadgeComponent } from '../../shared/components/status-badge.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../../core/services/orders.service\";\nimport * as i3 from \"../../core/services/tracking.service\";\nimport * as i4 from \"@angular/common\";\nfunction OrderDetailComponent_div_2_ng_container_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"p\")(2, \"b\");\n    i0.ɵɵtext(3, \"Estado (Redis):\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(4);\n    i0.ɵɵelementStart(5, \"small\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(7, \"status-badge\", 3);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.tracking.status, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"(\", ctx_r0.tracking.updatedAt || \"s/fecha\", \")\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"text\", ctx_r0.staleText)(\"warn\", ctx_r0.stale)(\"ok\", !ctx_r0.stale && !!ctx_r0.tracking);\n  }\n}\nfunction OrderDetailComponent_div_2_p_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1, \"No hay datos de tracking (Redis).\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction OrderDetailComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"p\")(2, \"b\");\n    i0.ɵɵtext(3, \"Producto:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"p\")(6, \"b\");\n    i0.ɵɵtext(7, \"Direcci\\u00F3n:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"p\")(10, \"b\");\n    i0.ɵɵtext(11, \"Status (MySQL):\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(12);\n    i0.ɵɵelementStart(13, \"small\");\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(15, OrderDetailComponent_div_2_ng_container_15_Template, 8, 5, \"ng-container\", 2)(16, OrderDetailComponent_div_2_p_16_Template, 2, 0, \"p\", 2);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.order.product, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.order.address, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.order.status, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"(\", ctx_r0.order.updatedAt || \"s/fecha\", \")\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.tracking);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !ctx_r0.tracking);\n  }\n}\nfunction OrderDetailComponent_ng_template_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"Cargando...\");\n  }\n}\nexport let OrderDetailComponent = /*#__PURE__*/(() => {\n  class OrderDetailComponent {\n    constructor(route, orders, trackingSvc) {\n      this.route = route;\n      this.orders = orders;\n      this.trackingSvc = trackingSvc;\n      this.stale = false;\n      this.staleText = '';\n    }\n    ngOnInit() {\n      const id = this.route.snapshot.paramMap.get('id');\n      this.orders.getById(id).subscribe(o => {\n        this.order = o;\n        this.fetchTracking(id);\n      });\n    }\n    fetchTracking(id) {\n      this.trackingSvc.getState(id).subscribe({\n        next: t => {\n          this.tracking = t;\n          this.checkConsistency();\n        },\n        error: _err => {\n          this.tracking = undefined;\n          this.stale = true;\n          this.staleText = 'Sin tracking (posible inconsistencia)';\n        }\n      });\n    }\n    checkConsistency() {\n      if (!this.order || !this.tracking) {\n        this.stale = true;\n        this.staleText = 'Datos incompletos';\n        return;\n      }\n      const tOrder = this.order.updatedAt ? Date.parse(this.order.updatedAt) : 0;\n      const tRedis = this.tracking.updatedAt ? Date.parse(this.tracking.updatedAt) : 0;\n      this.stale = tRedis + 5000 < tOrder;\n      this.staleText = this.stale ? 'Redis desactualizado respecto a MySQL' : 'Consistente';\n    }\n    static {\n      this.ɵfac = function OrderDetailComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || OrderDetailComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.OrdersService), i0.ɵɵdirectiveInject(i3.TrackingService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: OrderDetailComponent,\n        selectors: [[\"app-order-detail\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 5,\n        vars: 3,\n        consts: [[\"loading\", \"\"], [4, \"ngIf\", \"ngIfElse\"], [4, \"ngIf\"], [3, \"text\", \"warn\", \"ok\"]],\n        template: function OrderDetailComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"h2\");\n            i0.ɵɵtext(1);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(2, OrderDetailComponent_div_2_Template, 17, 6, \"div\", 1)(3, OrderDetailComponent_ng_template_3_Template, 1, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n          }\n          if (rf & 2) {\n            const loading_r2 = i0.ɵɵreference(4);\n            i0.ɵɵadvance();\n            i0.ɵɵtextInterpolate1(\"Pedido #\", ctx.order == null ? null : ctx.order.id, \"\");\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.order)(\"ngIfElse\", loading_r2);\n          }\n        },\n        dependencies: [CommonModule, i4.NgIf, StatusBadgeComponent],\n        encapsulation: 2\n      });\n    }\n  }\n  return OrderDetailComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}